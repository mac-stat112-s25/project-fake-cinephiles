---
title: "Combining the Letterboxd and IMDb Datasets"
format: html
---

# Import datasets and clean them using steps established in cleaning files {.unnumbered}
```{r}
library(tidyverse)
library(stringr)
library(fuzzyjoin)

# load the newly imdb dataset which has been cleaned 
imdb_cleaned <-read_csv("../data/cleaned_imdb.csv")

# fix issue of multliple listings for same film by averaging scores: 
imdb_cleaned_avg <- imdb_cleaned %>%
  group_by(Title) %>%
  summarise(Rating = mean(Rating, na.rm = TRUE)) %>%
  ungroup()


# import data
letterboxd_data <- read_csv("..\\data\\letterboxd_250movie_reviews.csv")

letterboxd_convertStars <-letterboxd_data |>
  mutate(numerical_rating = fct_recode(Rating, "5" = "★★★★★",
                                       "4.5" = "★★★★½", 
                                        "4" = "★★★★",
                                       "3.5" = "★★★½",
                                        "3" = "★★★",
                                        "2.5" = "★★½", 
                                        "2" = "★★",
                                       "1.5" =  "★½",
                                        "1" = "★",
                                       ".5" = "½"))

letterboxd_clean <- letterboxd_convertStars |>
  filter(!is.na(numerical_rating)) |>
  mutate(
    numerical_rating = as.numeric(as.character(numerical_rating)),
    out_of_ten = numerical_rating *2) |>
  group_by(Movie) |>
  summarise(
    avg_rating = mean(out_of_ten, na.rm = TRUE),
  ) |> 
arrange(desc(avg_rating))
```
# Import Mapping File & Merge {.unnumbered}
created a manual title mapping file to help handle differences in names

```{r}
title_map <- read_csv("../data/title_mapping.csv", locale = locale(encoding = "latin1"))

# Clean both sets of titles
title_map_cleaned <- title_map %>%
  mutate(imdb_title = str_trim(str_to_lower(imdb_title)))

imdb_cleaned_avg_cleaned <- imdb_cleaned_avg %>%
  mutate(Title = str_trim(str_to_lower(Title)))

# Join the mapping to the IMDb data by IMDb title
imdb_mapped <- title_map |>
  left_join(imdb_cleaned_avg, by = c("imdb_title" = "Title")) |>
  select(letterboxd_title, Rating) |> 
  rename(Title = letterboxd_title)

# Preview the joined data
head(imdb_mapped)
```



